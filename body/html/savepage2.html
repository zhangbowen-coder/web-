<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>选择存档</title>
    <link href="css\savepage2.css" rel="stylesheet">
    
<link href="css\bootstrap.min.css" rel="stylesheet">
<script src="js\cUser.js"></script>    
<script src="js\savepage2.js"></script>
<script src="js\cGameSystem.js"></script>
<script src="js\lang.js"></script>
<script src="js\story.js"></script>

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .b-example-divider {
        height: 3rem;
        background-color: rgba(0, 0, 0, .1);
        border: solid rgba(0, 0, 0, .15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
      }

      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }

      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .right {
        float:right;
        }
    </style>


    <script>
      var save_page_to_game_username = sessionStorage.getItem("loginUser");
      //取出用户信息
      var save_page_to_game_user_data = localStorage.getItem(save_page_to_game_username);
      var JSON_save_page_to_game_user_data = JSON.parse(save_page_to_game_user_data);
      var save_page_to_game_user_class = new cUser(save_page_to_game_username,JSON_save_page_to_game_user_data.password,JSON_save_page_to_game_user_data);
      function CheckIfExist(save_place_number)//检查此处是否有存档
      {
        if(save_place_number>=save_page_to_game_user_class.saveArray.length) return false;//不存在
        else return true;//存在
      }
      function go_to_play_this_game(save_place_number,this_page_type)// 还需要改
      {
          if(this_page_type=='read')// 读取存档部分
          {   
              if(CheckIfExist(save_place_number)==false) return ; //如果无存档，则不反应 
              // let save_page_cSave_class = cSave(cUser.saveArray[save_place_number].saveDate,cUser.saveArray[save_place_number].nodeId.cUser.saveArray[save_place_number].choices);
              let save_page_cSave_class = new cSave(save_page_to_game_user_class.saveArray[save_place_number]);
              var STRING_save_page_cSave_class = JSON.stringify(save_page_cSave_class);
              sessionStorage.setItem("currentSaveData",STRING_save_page_cSave_class);
              alert("读取成功");
              window.location.href='./gameApp.html';
          }
          else if(this_page_type=='write')// 手动存档部分
          {
              save_page_to_game_user_class.renew(save_place_number);
          }
      }
          //显示场景，时间等。
      function getInformation(nodeId,class_type,num)
      {
          let config = story.getNode(nodeId);
          if(num==1)
          {
            if(nodeId==100||nodeId==99) 
            {
              document.getElementById(class_type).innerHTML= '第1幕'+'<br>' +'开场动画';
            }
            else document.getElementById(class_type).innerHTML= '第'+ Math.floor(nodeId/10000) + '幕'+'<br>' +lang.get('story.time.'+ config.time)+'<br>'+lang.get('story.position.'+config.position);
          }
          else if(num==2)
          {
              document.getElementById(class_type).src = './img/bgr/' + config.bgr + '.jpg';
          }
      }
      
    </script>



    
  </head>
  <body class="bg-secondary">
    
<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark" aria-label="Main navigation">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><b>beloved-wife</b></a>
    <button class="navbar-toggler p-0 border-0" type="button" id="navbarSideCollapse" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      </ul>
      <form class="d-flex">
        <button class="btn btn-outline-success" type="button" onclick="bbback();" id="back_button_">返回</button>
        <script>
          function bbback()
          {
            location.href="./savefile.html"
          }
        </script>
      </form>
    </div>
  </div>
</nav>

<main class="container">
  <div class="d-flex align-items-center p-4 my-4 text-white bg-black rounded shadow-sm right" style="height: 150px; width: 50%;">
    <div class="lh-1 col-md-4">
      <h1 class="h2 mb-0 text-white lh-1">存档1</h1>
      <p id="oneoneone"></p>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(0,'read')">读取</button>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(0,'write');upd()">存储</button>
      <script>
        if(save_page_to_game_user_class.saveArray.length>=1&&save_page_to_game_user_class.saveArray[0]!=null) oneoneone.innerHTML = ' '+save_page_to_game_user_class.saveArray[0].saveDate;
        else oneoneone.innerHTML = '空';
      </script>
    </div>
    <div class="col-md-4" style="text-align: center;">
      <p id="one_sec" style="color:aliceblue"></p>
    </div>
    <div class="col-md-4">
      <img id="one_bgr" class="border text-lg-end" style="max-width:100%">
    </div>
    <script>
        if(save_page_to_game_user_class.saveArray[0]!=null)
        {
          getInformation(save_page_to_game_user_class.saveArray[0].nodeId,'one_sec',1);
          getInformation(save_page_to_game_user_class.saveArray[0].nodeId,'one_bgr',2);
        }
        else document.getElementById("one_bgr").src = "../img/bgr/black.jpg";
        function upd()
        {
            oneoneone.innerHTML = ' '+save_page_to_game_user_class.saveArray[0].saveDate;
            getInformation(save_page_to_game_user_class.saveArray[0].nodeId,'one_sec',1);
            if(save_page_to_game_user_class.saveArray[0]!=null)getInformation(save_page_to_game_user_class.saveArray[0].nodeId,'one_bgr',2);
        }
    </script>
  </div>
  <div style="clear:both"></div>
  <div class="d-flex align-items-center p-4 my-4 text-white bg-black rounded shadow-sm right" style="height: 150px; width: 50%;">
    <div class="lh-1 col-md-4">
      <h1 class="h2 mb-0 text-white lh-1">存档2</h1>
      <p id="twotwotwo"></p>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(1,'read')">读取</button>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(1,'write');upd2()">存储</button>
      <script>
        if(save_page_to_game_user_class.saveArray.length>=2&&save_page_to_game_user_class.saveArray[1]!=null) twotwotwo.innerHTML = ' '+save_page_to_game_user_class.saveArray[1].saveDate;
        else twotwotwo.innerHTML = '空';
      </script>
    </div>
    <div class="col-md-4" style="text-align: center;">
      <p id="two_sec" style="color:aliceblue"></p>
    </div>
    <div class="col-md-4">
      <img id="two_bgr" class="border text-lg-end" style="max-width:100%" alt="...">
    </div>
    <script>
      if(save_page_to_game_user_class.saveArray[1]!=null)
      {
          getInformation(save_page_to_game_user_class.saveArray[1].nodeId,'two_sec',1);
          getInformation(save_page_to_game_user_class.saveArray[1].nodeId,'two_bgr',2);
      }
      function upd2()
      {
          twotwotwo.innerHTML = ' '+save_page_to_game_user_class.saveArray[1].saveDate;
          getInformation(save_page_to_game_user_class.saveArray[1].nodeId,'two_sec',1);
          if(save_page_to_game_user_class.saveArray[1]!=null)getInformation(save_page_to_game_user_class.saveArray[1].nodeId,'two_bgr',2);
      }
    </script>
  </div>
  <div style="clear:both"></div>
  <!--3-->
  <div class="d-flex align-items-center p-4 my-4 text-white bg-black rounded shadow-sm right" style="height: 150px; width: 50%;">
    <div class="lh-1 col-md-4">
      <h1 class="h2 mb-0 text-white lh-1">存档3</h1>
      <p id="threethree"></p>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(2,'read')">读取</button>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(2,'write');upd3()">存储</button>
      <script>
        if(save_page_to_game_user_class.saveArray.length>=3&&save_page_to_game_user_class.saveArray[2]!=null) threethree.innerHTML = ' '+save_page_to_game_user_class.saveArray[2].saveDate;
        else threethree.innerHTML = '空';
      </script>
    </div>
    <div class="col-md-4" style="text-align: center;">
      <p id="three_sec" style="color:aliceblue"></p>
    </div>
    <div class="col-md-4">
      <img id="three_bgr" class="border text-lg-end" style="max-width:100%" alt="...">
    </div>
    <script>
      if(save_page_to_game_user_class.saveArray[2]!=null)
      {
          getInformation(save_page_to_game_user_class.saveArray[2].nodeId,'three_sec',1);
          getInformation(save_page_to_game_user_class.saveArray[2].nodeId,'three_bgr',2);
      }
      function upd3()
        {
            threethree.innerHTML = ' '+save_page_to_game_user_class.saveArray[2].saveDate;
            getInformation(save_page_to_game_user_class.saveArray[2].nodeId,'three_sec',1);
            if(save_page_to_game_user_class.saveArray[2]!=null)getInformation(save_page_to_game_user_class.saveArray[2].nodeId,'three_bgr',2);
        }
    </script>
  </div>
  <div style="clear:both"></div>
  <div class="d-flex align-items-center p-4 my-4 text-white bg-black rounded shadow-sm right" style="height: 150px; width: 50%;">
    <div class="lh-1 col-md-4">
      <h1 class="h2 mb-0 text-white lh-1">存档4</h1>
      <p id="fourfour"></p>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(3,'read')">读取</button>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(3,'write');upd4()">存储</button>
      <script>
        if(save_page_to_game_user_class.saveArray.length>=4&&save_page_to_game_user_class.saveArray[3]!=null) fourfour.innerHTML = ' '+save_page_to_game_user_class.saveArray[3].saveDate;
        else fourfour.innerHTML = '空';
      </script>
    </div>
    <div class="col-md-4" style="text-align: center;">
      <p id="four_sec" style="color:aliceblue"></p>
    </div>
    <div class="col-md-4">
      <img id="four_bgr" class="border text-lg-end" style="max-width:100%" alt="...">
    </div>
    <script>
      if(save_page_to_game_user_class.saveArray[3]!=null)
      {
         getInformation(save_page_to_game_user_class.saveArray[3].nodeId,'four_sec',1);
         getInformation(save_page_to_game_user_class.saveArray[3].nodeId,'four_bgr',2);
      }
      else document.getElementById("four_bgr").src = "../img/bgr/index-bgr.jpg";
      function upd4()
        {
            fourfour.innerHTML = ' '+save_page_to_game_user_class.saveArray[3].saveDate;
            getInformation(save_page_to_game_user_class.saveArray[3].nodeId,'four_sec',1);
            if(save_page_to_game_user_class.saveArray[3]!=null)getInformation(save_page_to_game_user_class.saveArray[3].nodeId,'four_bgr',2);
        }
    </script>
  </div>
  <div style="clear:both"></div>
  <div class="d-flex align-items-center p-4 my-4 text-white bg-black rounded shadow-sm right" style="height: 150px; width: 50%;">
    <div class="lh-1 col-md-4">
      <h1 class="h2 mb-0 text-white lh-1">存档5</h1>
      <p id="fivefive"></p>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(4,'read')">读取</button>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(4,'write');upd5()">存储</button>
      <script>
        if(save_page_to_game_user_class.saveArray.length>=5&&save_page_to_game_user_class.saveArray[4]!=null) fivefive.innerHTML = ' '+save_page_to_game_user_class.saveArray[4].saveDate;
        else fivefive.innerHTML = '空';
      </script>
    </div>
    <div class="col-md-4" style="text-align: center;">
      <p id="five_sec" style="color:aliceblue"></p>
    </div>
    <div class="col-md-4">
      <img id="five_bgr" class="border text-lg-end" style="max-width:100%" alt="...">
    </div>
    <script>
      if(save_page_to_game_user_class.saveArray[4]!=null)
      {
          getInformation(save_page_to_game_user_class.saveArray[4].nodeId,'five_sec',1);
          getInformation(save_page_to_game_user_class.saveArray[4].nodeId,'five_bgr',2);
      } 
      function upd5()
        {
            fivefive.innerHTML = ' '+save_page_to_game_user_class.saveArray[4].saveDate;
            getInformation(save_page_to_game_user_class.saveArray[4].nodeId,'five_sec',1);
            if(save_page_to_game_user_class.saveArray[4]!=null)getInformation(save_page_to_game_user_class.saveArray[4].nodeId,'five_bgr',2);
        }
    </script>
  </div>
  <div style="clear:both"></div>
  <div class="d-flex align-items-center p-4 my-4 text-white bg-black rounded shadow-sm right" style="height: 150px; width: 50%;">
    <div class="lh-1 col-md-4">
      <h1 class="h2 mb-0 text-white lh-1">存档6</h1>
      <p id="sixsix"></p>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(5,'read')">读取</button>
      <button class="btn btn-light" type="button" onclick="go_to_play_this_game(5,'write');upd6()">存储</button>
      <script>
        if(save_page_to_game_user_class.saveArray.length>=6&&save_page_to_game_user_class.saveArray[5]!=null) sixsix.innerHTML = ' '+save_page_to_game_user_class.saveArray[5].saveDate;
        else sixsix.innerHTML = '空';
      </script>
    </div>
    <div class="col-md-4" style="text-align: center;">
      <p id="six_sec" style="color:aliceblue"></p>
    </div>
    <div class="col-md-4">
      <img id="six_bgr" class="border text-lg-end" style="max-width:100%" alt="...">
    </div>
    <script>
      if(save_page_to_game_user_class.saveArray[5]!=null)
      {
          getInformation(save_page_to_game_user_class.saveArray[5].nodeId,'six_sec',1);
          getInformation(save_page_to_game_user_class.saveArray[5].nodeId,'six_bgr',2);
      }
       function upd6()
        {
            sixsixsix.innerHTML = ' '+save_page_to_game_user_class.saveArray[5].saveDate;
            getInformation(save_page_to_game_user_class.saveArray[5].nodeId,'six_sec',1);
            if(save_page_to_game_user_class.saveArray[5]!=null)getInformation(save_page_to_game_user_class.saveArray[5].nodeId,'six_bgr',2);
        }
    </script>
  </div>
  <div style="clear:both"></div>
 
</main>
  </body>
</html>